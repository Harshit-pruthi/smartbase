<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Learn - Smartbase</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* same theme as dashboard */
    body { margin:0; font-family:'Segoe UI',Tahoma; background:#f5f7fa; color:#202124; display:flex; min-height:100vh;}
    .sidebar{width:260px;background:#fff;box-shadow:0 4px 12px rgba(0,0,0,.08);padding:24px 0;display:flex;flex-direction:column;}
    .logo{display:flex;align-items:center;padding:0 24px 24px;border-bottom:1px solid rgba(0,0,0,.06);margin-bottom:24px;}
    .logo-icon{font-size:28px;color:#4285f4;margin-right:12px;}
    .logo-text{font-size:22px;font-weight:700;}
    .nav-item{display:flex;align-items:center;padding:14px 24px;margin:6px 12px;border-radius:10px;color:#5f6368;text-decoration:none;}
    .nav-item.active{background:rgba(66,133,244,.12);color:#4285f4;font-weight:600;}
    .nav-icon{margin-right:12px;font-size:20px;}
    .main-content{flex:1;padding:24px;overflow-y:auto;}
    .header{display:flex;justify-content:space-between;align-items:center;margin-bottom:32px;}
    .chapters-container{background:#fff;border-radius:16px;padding:24px;box-shadow:0 4px 12px rgba(0,0,0,.08);}
    .chapter-item{padding:20px;border-bottom:1px solid rgba(0,0,0,.06);cursor:pointer;}
    .chapter-title{font-size:18px;font-weight:600;color:#4285f4;margin-bottom:8px;display:flex;align-items:center;}
    .chapter-title i{margin-right:10px;}
    .chapter-excerpt{color:#5f6368;margin-left:26px;}
    .loading{text-align:center;padding:40px;}
    .spinner{width:40px;height:40px;border:4px solid rgba(0,0,0,.1);border-radius:50%;border-left-color:#4285f4;animation:spin 1s linear infinite;margin:0 auto 16px;}
    @keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
    .error-state{text-align:center;background:#ffebee;border-radius:12px;padding:24px;margin-bottom:24px;}
    .error-state h3{color:#c62828;}
  </style>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script>
    // Your Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyA0cWgKUrqdjvqui7EcBHb41e7vzFRjdLw",
      authDomain: "smartbase-dc49d.firebaseapp.com",
      projectId: "smartbase-dc49d",
      storageBucket: "smartbase-dc49d.firebasestorage.app",
      messagingSenderId: "786622743871",
      appId: "1:786622743871:web:3adcfe2c399208042b7f8a"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();
  </script>
</head>
<body>
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="logo"><div class="logo-icon"><i class="fas fa-brain"></i></div><div class="logo-text">Smartbase</div></div>
    <a href="learn.html" class="nav-item active"><div class="nav-icon"><i class="fas fa-book"></i></div>Learn</a>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <div class="header">
      <h1>Accountancy Chapters</h1>
      <div id="userName">Loading...</div>
    </div>
    <div class="chapters-container">
      <h2><i class="fas fa-book-open"></i> Available Chapters</h2>
      <div id="loadingState" class="loading"><div class="spinner"></div><p>Loading chapters...</p></div>
      <div id="errorState" class="error-state" style="display:none;"><h3 id="errorMessage"></h3></div>
      <ul id="chaptersList" style="list-style:none;display:none;"></ul>
    </div>
  </main>

  <script>
    auth.onAuthStateChanged(user=>{
      if(user){
        document.getElementById('userName').textContent=user.displayName||user.email;
        loadChapters();
      }else{
        window.location.href='signin.html';
      }
    });

    function loadChapters(){
      document.getElementById('loadingState').style.display='block';
      db.collection('Root').doc('Learn').collection('Accountancy').get()
      .then(snapshot=>{
        const list=document.getElementById('chaptersList');
        list.innerHTML='';
        if(snapshot.empty){showError("No chapters found.");return;}
        snapshot.forEach(doc=>{
          const key=doc.id;
          const value=doc.data()[key]||JSON.stringify(doc.data());
          const li=document.createElement('li');
          li.className='chapter-item';
          li.innerHTML=`
            <div class="chapter-title"><i class="fas fa-file-alt"></i>${key}</div>
            <div class="chapter-excerpt">${value}</div>
          `;
          li.onclick=()=>alert(`Opening ${key}\n\n${value}`);
          list.appendChild(li);
        });
        document.getElementById('loadingState').style.display='none';
        list.style.display='block';
      })
      .catch(err=>showError(err.message));
    }
    function showError(msg){
      document.getElementById('loadingState').style.display='none';
      document.getElementById('errorMessage').textContent=msg;
      document.getElementById('errorState').style.display='block';
    }
  </script>
</body>
</html>
