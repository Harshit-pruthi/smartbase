<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>SmartBase Dashboard</title>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap');

    body {
        margin: 0;
        font-family: 'Roboto', sans-serif;
        background: #f0f2f5;
        display: flex;
        height: 100vh;
        overflow: hidden;
    }

    .sidebar {
        width: 260px;
        background: #4b4276;
        color: #fff;
        display: flex;
        flex-direction: column;
        padding: 20px 0;
        box-shadow: 2px 0 12px rgba(0,0,0,0.1);
    }

    .profile {
        display: flex;
        align-items: center;
        padding: 0 30px 30px 30px;
        border-bottom: 1px solid rgba(255,255,255,0.2);
    }

    .profile img {
        border-radius: 50%;
        width: 48px;
        height: 48px;
        margin-right: 12px;
        border: 2px solid #fff;
    }

    .profile-name {
        font-weight: 700;
        font-size: 1rem;
        color: #fff;
    }

    .nav-link {
        padding: 15px 30px;
        cursor: pointer;
        text-transform: uppercase;
        font-weight: 600;
        font-size: 0.9rem;
        letter-spacing: 1px;
        transition: background 0.3s;
        user-select: none;
    }

    .nav-link:hover, .nav-link.active {
        background: #6a5acd;
    }

    .content {
        flex-grow: 1;
        padding: 30px;
        overflow-y: auto;
        background: #fff;
    }

    h2 {
        margin-top: 0;
        font-weight: 700;
        color: #4b4276;
    }

    .section-card {
        background: #ede7f6;
        border-radius: 16px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 8px rgba(75, 66, 118, 0.2);
    }

    .section-card h3 {
        margin-top: 0;
        font-weight: 700;
        margin-bottom: 12px;
        color: #4b4276;
    }

    .mcq-question {
        font-weight: 600;
        margin-bottom: 12px;
    }

    .mcq-options {
        list-style: none;
        padding: 0;
    }

    .mcq-options li {
        background: white;
        margin-bottom: 8px;
        padding: 10px 16px;
        border-radius: 12px;
        cursor: pointer;
        box-shadow: 0 1px 4px rgba(0,0,0,0.15);
        transition: background 0.3s;
    }

    .mcq-options li:hover {
        background: #c5cae9;
    }

    .mcq-options li.selected {
        background-color: #7e57c2;
        color: white;
        font-weight: 700;
    }

    .progress-bar {
        background: #d1c4e9;
        border-radius: 12px;
        overflow: hidden;
        height: 16px;
        margin-top: 10px;
    }

    .progress-bar-fill {
        background: #5e35b1;
        height: 100%;
        width: 0;
        transition: width 0.4s ease-in-out;
    }

    @media (max-width: 768px) {
        body {
            flex-direction: column;
            height: auto;
        }
        .sidebar {
            width: 100%;
            flex-direction: row;
            overflow-x: auto;
            padding: 10px 0;
        }
        .nav-link {
            flex: 1 0 auto;
            text-align: center;
            padding: 12px 10px;
            font-size: 0.85rem;
            border-right: 1px solid #6a5acd;
        }
        .nav-link:last-child {
            border-right: none;
        }
        .content {
            padding: 15px;
            height: auto;
        }
        .profile {
            padding: 10px;
            justify-content: center;
            border-bottom: none;
            border-top: 1px solid rgba(255,255,255,0.2);
        }
        .profile-name {
            font-size: 0.9rem;
        }
    }
</style>
</head>
<body>
<div class="sidebar">
    <div class="profile">
        <img id="profile-pic" src="" alt="Profile Picture" />
        <div class="profile-name" id="profile-name"></div>
    </div>
    <div class="nav-link active" data-section="learn">Learn Concepts</div>
    <div class="nav-link" data-section="practice">Practice Questions</div>
    <div class="nav-link" data-section="progress">Progress Tracker</div>
</div>

<div class="content" id="content">
    <!-- Dynamic content loads here -->
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<script>
    // TODO: Replace with your Firebase project config
    const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "YOUR_AUTH_DOMAIN",
        projectId: "YOUR_PROJECT_ID",
        storageBucket: "YOUR_STORAGE_BUCKET",
        messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
        appId: "YOUR_APP_ID"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();

    const contentDiv = document.getElementById('content');
    const profilePic = document.getElementById('profile-pic');
    const profileName = document.getElementById('profile-name');
    const navLinks = document.querySelectorAll('.nav-link');

    let currentUser = null;

    auth.onAuthStateChanged(user => {
        if (user) {
            currentUser = user;
            profileName.textContent = user.displayName || 'Student';
            profilePic.src = user.photoURL || '';
            loadSection('learn'); // default load Learn Concepts
        } else {
            window.location.href = 'index.html';
        }
    });

    navLinks.forEach(link => {
        link.addEventListener('click', () => {
            navLinks.forEach(l => l.classList.remove('active'));
            link.classList.add('active');
            loadSection(link.getAttribute('data-section'));
        });
    });

    function loadSection(section) {
        if (section === 'learn') {
            loadLearnConcepts();
        } else if (section === 'practice') {
            loadPracticeQuestions();
        } else if (section === 'progress') {
            loadProgressTracker();
        }
    }

    // Learn Concepts - simple static content for demonstration
    function loadLearnConcepts() {
        contentDiv.innerHTML = `
            <h2>Learn Concepts</h2>
            <div class="section-card">
                <h3>Chapter 4: Dissolution of Partnership</h3>
                <p>Dissolution of partnership refers to termination of partnership, i.e., closing the partnership business.</p>
                <p>In this chapter, you will learn about dissolution process, settlement of accounts, and legal aspects.</p>
            </div>
        `;
    }

    // Load Practice Questions - get MCQs JSON from Firebase Storage
    async function loadPracticeQuestions() {
        contentDiv.innerHTML = '<h2>Practice Questions</h2><div id="mcq-container"></div>';
        const container = document.getElementById('mcq-container');

        try {
            const mcqPath = 'Accountancy/Chapter4 Dissolution/mcq/Questions.json';
            const mcqRef = storage.ref(mcqPath);
            const url = await mcqRef.getDownloadURL();
            const response = await fetch(url);
            const mcqData = await response.json();

            const userProgressDoc = db.collection('progress').doc(currentUser.uid);
            const userProgressSnap = await userProgressDoc.get();
            const userProgress = userProgressSnap.exists ? userProgressSnap.data() : {};

            container.innerHTML = '';
            mcqData.questions.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'section-card';

                const questionTitle = document.createElement('div');
                questionTitle.className = 'mcq-question';
                questionTitle.textContent = (index + 1) + '. ' + q.question;

                const optionsList = document.createElement('ul');
                optionsList.className = 'mcq-options';

                q.options.forEach(opt => {
                    const optionItem = document.createElement('li');
                    optionItem.textContent = opt;

                    if (userProgress[q.id] === opt) {
                        optionItem.classList.add('selected');
                    }

                    optionItem.addEventListener('click', () => {
                        optionsList.querySelectorAll('li').forEach(li => li.classList.remove('selected'));
                        optionItem.classList.add('selected');
                        userProgressDoc.set({ [q.id]: opt }, { merge: true });
                    });

                    optionsList.appendChild(optionItem);
                });

                questionDiv.appendChild(questionTitle);
                questionDiv.appendChild(optionsList);
                container.appendChild(questionDiv);
            });
        } catch (err) {
            container.innerHTML = '<p style="color: red;">Failed to load questions. Please try again later.</p>';
            console.error('Error loading MCQs:', err);
        }
    }

    // Show Progress Tracker based on answered questions
    async function loadProgressTracker() {
        contentDiv.innerHTML = '<h2>Progress Tracker</h2><div id="progress-content">Loading progress...</div>';
        const progressContent = document.getElementById('progress-content');

        try {
            const userProgressDoc = db.collection('progress').doc(currentUser.uid);
            const progressSnap = await userProgressDoc.get();
            const progressData = progressSnap.exists ? progressSnap.data() : {};

            const answeredKeys = Object.keys(progressData);

            const mcqPath = 'Accountancy/Chapter4 Dissolution/mcq/Questions.json';
            const mcqRef = storage.ref(mcqPath);
            const url = await mcqRef.getDownloadURL();
            const response = await fetch(url);
            const mcqData = await response.json();
            const totalQuestionsCount = mcqData.questions.length;

            const answeredCount = answeredKeys.length;
            const percentComplete = totalQuestionsCount === 0 ? 0 : Math.round((answeredCount / totalQuestionsCount) * 100);

            progressContent.innerHTML = `
                <p>You have answered <strong>${answeredCount}</strong> out of <strong>${totalQuestionsCount}</strong> questions.</p>
                <div class="progress-bar">
                    <div class="progress-bar-fill" style="width: ${percentComplete}%;"></div>
                </div>
                <p>Completion: <strong>${percentComplete}%</strong></p>
            `;
        } catch (err) {
            progressContent.innerHTML = '<p style="color: red;">Failed to load progress. Please try again later.</p>';
            console.error('Error loading progress:', err);
        }
    }
</script>
</body>
</html>
